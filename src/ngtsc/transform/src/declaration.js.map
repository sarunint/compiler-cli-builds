{"version":3,"file":"declaration.js","sourceRoot":"","sources":["../../../../../../../packages/compiler-cli/src/ngtsc/transform/src/declaration.ts"],"names":[],"mappings":";AAAA;;;;;;GAMG;;AAEH,iCAAiC;AAEjC,iDAA8D;AAM9D;;GAEG;AACH,MAAa,kBAAkB;IAI7B,YAAoB,eAAmC,EAAE,YAAqB;QAA1D,oBAAe,GAAf,eAAe,CAAoB;QAH/C,cAAS,GAAG,IAAI,GAAG,EAA2B,CAAC;QAIrD,IAAI,CAAC,OAAO,GAAG,IAAI,0BAAa,CAAC,eAAe,KAAK,IAAI,EAAE,YAAY,CAAC,CAAC;IAC3E,CAAC;IAED;;OAEG;IACH,iBAAiB,CAAC,IAAY,EAAE,KAAsB,IAAU,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,EAAE,KAAK,CAAC,CAAC,CAAC,CAAC;IAElG;;OAEG;IACH,SAAS,CAAC,GAAW,EAAE,MAAc;QACnC,MAAM,OAAO,GACT,EAAE,CAAC,gBAAgB,CAAC,UAAU,EAAE,GAAG,EAAE,EAAE,CAAC,YAAY,CAAC,MAAM,EAAE,KAAK,EAAE,EAAE,CAAC,UAAU,CAAC,EAAE,CAAC,CAAC;QAE1F,KAAK,IAAI,CAAC,GAAG,OAAO,CAAC,UAAU,CAAC,MAAM,GAAG,CAAC,EAAE,CAAC,IAAI,CAAC,EAAE,CAAC,EAAE,EAAE;YACvD,MAAM,IAAI,GAAG,OAAO,CAAC,UAAU,CAAC,CAAC,CAAC,CAAC;YACnC,IAAI,EAAE,CAAC,kBAAkB,CAAC,IAAI,CAAC,IAAI,IAAI,CAAC,IAAI,KAAK,SAAS;gBACtD,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,EAAE;gBACtC,MAAM,KAAK,GAAG,IAAI,CAAC,SAAS,CAAC,GAAG,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAG,CAAC;gBACnD,MAAM,MAAM,GAAG,GAAG,CAAC,SAAS,CAAC,CAAC,EAAE,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;gBAC9C,MAAM,KAAK,GAAG,GAAG,CAAC,SAAS,CAAC,IAAI,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC;gBAE1C,GAAG,GAAG,MAAM;oBACR,KAAK;yBACA,GAAG,CAAC,IAAI,CAAC,EAAE;wBACV,MAAM,IAAI,GAAG,0BAAa,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,OAAO,CAAC,CAAC;wBACpD,OAAO,cAAc,IAAI,CAAC,IAAI,KAAK,IAAI,KAAK,CAAC;oBAC/C,CAAC,CAAC;yBACD,IAAI,CAAC,EAAE,CAAC;oBACb,KAAK,CAAC;aACX;SACF;QAED,MAAM,OAAO,GAAG,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,MAAM,EAAE,IAAI,CAAC,eAAe,CAAC,CAAC;QACzE,IAAI,OAAO,CAAC,MAAM,KAAK,CAAC,EAAE;YACxB,GAAG,GAAG,OAAO,CAAC,GAAG,CAAC,CAAC,CAAC,EAAE,CAAC,eAAe,CAAC,CAAC,EAAE,UAAU,CAAC,CAAC,IAAI,MAAM,CAAC,CAAC,IAAI,CAAC,EAAE,CAAC,GAAG,GAAG,CAAC;SAClF;QAED,OAAO,GAAG,CAAC;IACb,CAAC;CACF;AA9CD,gDA8CC","sourcesContent":["/**\n * @license\n * Copyright Google Inc. All Rights Reserved.\n *\n * Use of this source code is governed by an MIT-style license that can be\n * found in the LICENSE file at https://angular.io/license\n */\n\nimport * as ts from 'typescript';\n\nimport {ImportManager, translateType} from '../../translator';\n\nimport {CompileResult} from './api';\n\n\n\n/**\n * Processes .d.ts file text and adds static field declarations, with types.\n */\nexport class DtsFileTransformer {\n  private ivyFields = new Map<string, CompileResult[]>();\n  private imports: ImportManager;\n\n  constructor(private coreImportsFrom: ts.SourceFile|null, importPrefix?: string) {\n    this.imports = new ImportManager(coreImportsFrom !== null, importPrefix);\n  }\n\n  /**\n   * Track that a static field was added to the code for a class.\n   */\n  recordStaticField(name: string, decls: CompileResult[]): void { this.ivyFields.set(name, decls); }\n\n  /**\n   * Process the .d.ts text for a file and add any declarations which were recorded.\n   */\n  transform(dts: string, tsPath: string): string {\n    const dtsFile =\n        ts.createSourceFile('out.d.ts', dts, ts.ScriptTarget.Latest, false, ts.ScriptKind.TS);\n\n    for (let i = dtsFile.statements.length - 1; i >= 0; i--) {\n      const stmt = dtsFile.statements[i];\n      if (ts.isClassDeclaration(stmt) && stmt.name !== undefined &&\n          this.ivyFields.has(stmt.name.text)) {\n        const decls = this.ivyFields.get(stmt.name.text) !;\n        const before = dts.substring(0, stmt.end - 1);\n        const after = dts.substring(stmt.end - 1);\n\n        dts = before +\n            decls\n                .map(decl => {\n                  const type = translateType(decl.type, this.imports);\n                  return `    static ${decl.name}: ${type};\\n`;\n                })\n                .join('') +\n            after;\n      }\n    }\n\n    const imports = this.imports.getAllImports(tsPath, this.coreImportsFrom);\n    if (imports.length !== 0) {\n      dts = imports.map(i => `import * as ${i.as} from '${i.name}';\\n`).join('') + dts;\n    }\n\n    return dts;\n  }\n}\n"]}